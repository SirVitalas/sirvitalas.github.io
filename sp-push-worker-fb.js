"use strict";var sServerApi="https://pushdata.sendpulse.com:4434";self.addEventListener("install",function(t){t.waitUntil(self.skipWaiting())}),self.addEventListener("push",function(t){var c=!1;t.data&&(c=t.data.json()),t.waitUntil(self.registration.pushManager.getSubscription().then(function(t){if(c){if(c.notification)var n=c.notification.title,o=c.notification.body,e=c.notification.icon;else n=void 0,o=void 0,e=void 0;if(void 0===n)n=c.data.title;if(void 0===o)o=c.data.body;if(void 0===e)e=c.data.icon;var d=c.collapse_key,s=c.data.url,i=c.data.subscription,r="true"==c.data.requireInteraction,a={action:"statisctic",subscriptionId:i,statisctic_action:"delivered",task_id:parseInt(c.data.task_id),user_id:parseInt(c.data.user_id)};return void 0!==c.data.addData&&(a.addData=c.data.addData),fetch(sServerApi,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(t){var i={body:o,icon:e,tag:d,data:{redirectUrl:s},requireInteraction:r};if(void 0!==c.data.buttons){if("string"==typeof c.data.buttons)var a=JSON.parse(c.data.buttons);else a=c.data.buttons;i.actions=a,i.data.buttons=a}return void 0!==c.data.image&&(i.image=c.data.image),self.registration.showNotification(n,i)})}}))}),self.addEventListener("notificationclick",function(t){var n=t.notification.data.redirectUrl;if(void 0!==t.action){var i=t.action;if(void 0!==t.notification.data.buttons)for(var a=0;a<t.notification.data.buttons.length;a++)t.notification.data.buttons[a].action==i&&(n=t.notification.data.buttons[a].url)}t.notification.close(),t.waitUntil(clients.matchAll({type:"window"}).then(function(t){for(var i=0;i<t.length;i++){var a=t[i];if("/"==a.url&&"focus"in a)return a.focus()}if(clients.openWindow)return clients.openWindow(n)}))});